# VCA Demo: Contact List Application

This code is for an evaluation project for VCA Software.

## Live Demo

The live demo is available at [vcademo.pupp3r.net](https://vcademo.pupp3r.net)


## How it works
#### Classic ASP Side
The classic ASP aspect is relatively simple. It handles user creation and login, and stores the sessions in the ASP Session Store.

For password hashing, I used a [custom COM DLL which implements Bcrypt](https://github.com/as08/ClassicASP.Bcrypt). I also added password resetting, but it requires your original password because I really didn't want to implement email sending.

#### ASP.NET Side
I decided to use ASP.NET MVC because it allows for easier unit testing, as well as easier handling of the models with a DB Context automatically generated by Entity Framework.

I created a single page which uses AJAX and JQuery DataTables. The table loads data from a JSON endpoint, which enables reloading the data easily without a page refresh.

The pop-up modals for add/edit/delete I created manually, and added several javascript functions to facilitate the UI (see /MVC/Scripts/App/Contacts.js)

#### Sessions
Sessions are stored and managed by the ASP application. When ASP.NET wants to get Session info, it simply sends a request to an endpoint at /internal/session.asp. (This endpoint only responds to requests from the server itself)

The data is provided to/from this ASP page in JSON format. ASP.NET can also hit this endpoint with updated session data which ASP will save back into its Session Store.

If a session is expired or destroyed, the ASP page will initialize a new one and send it back anyway. ASP.NET can then check the data (e.g. Session["username"]) to determine if the user is actually signed in.

If ASP.NET detects that the session is missing user data, it will redirect back to the login page.

## Running locally

The demo is hosted on an Azure VM with a Windows Server 2022 instance running IIS and SQL Server.

In order to run it on your machine, you will need to do the following:
#### Classic ASP
- Place the Classic ASP code (everything under /ASP) in the "Default Web Site" in IIS (i.e. C:\inetpub\wwwroot)
- Create a SQL Server instance and create 2 tables: webuser and contact
    - You can find the Schema under /MVC/Models
- Set up a user that can read/write these 2 tables, and create a System DSN with the ODBC Driver to connect to the SQL instance
- Edit Global.asa with your connection string
- Install the custom Bcrypt COM DLL. You can find instructions [here](https://github.com/as08/ClassicASP.PasswordHashing).

#### ASP.NET MVC
- Create a virtual directory in IIS called VCA_Contact_Demo
- Build the project in Release mode and publish to this folder
- Set up folder permissions so that static files are accessible from the accounts used by IIS (usually IUSR and IIS_IUSRS)
- Edit Web.config to add your connection string

#### Other install notes
- On my hosted instance, I created an SSL certificate with a tool called [Certify The Web](https://certifytheweb.com/), which is basically a windows-friendly version of certbot with a nice GUI on top.


## Remarks
- The unit tests are rather trivial, but since all the MVC methods are either ActionResult or a DB query returning results, I didn't have much to test.
